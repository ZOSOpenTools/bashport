export ZOPEN_GIT_URL="https://github.com/bminor/bash.git"
export ZOPEN_GIT_BRANCH="devel"
export ZOPEN_GIT_DEPS="perl m4 autoconf curl gzip tar make zoslib coreutils diffutils sed ncurses bison"
export ZOPEN_TARBALL_URL="https://ftp.gnu.org/gnu/bash/bash-5.2.15.tar.gz"
export ZOPEN_TARBALL_DEPS="curl gzip tar make zoslib coreutils diffutils sed ncurses"
export ZOPEN_TYPE="GIT"
export ZOPEN_EXTRA_CPPFLAGS="-DNO_MAIN_ENV_ARG=1"
export ZOPEN_COMP=CLANG

rm -f patches
if [ "${ZOPEN_TYPE}x" = "TARBALLx" ]; then
	ln -s tarball-patches patches
else
	ln -s git-patches patches
  export ZOPEN_EXTRA_CONFIGURE_OPTS="--without-libintl-prefix --disable-nls"
  export ZOPEN_MAKE_OPTS="-j\$ZOPEN_NUM_JOBS LOCAL_LIBS=\"\$LIBS\" LIBS_FOR_BUILD=\"\$LIBS\""
  export ZOPEN_INSTALL_OPTS="-j\$ZOPEN_NUM_JOBS LOCAL_LIBS=\"\$LIBS\" LIBS_FOR_BUILD=\"\$LIBS\""
fi

zopen_check_results()
{
  dir="$1"
  pfx="$2"
  chk="$1/$2_check.log"

  failuretests=$(/bin/find tests/ -name "*.output"  ! -size 0)
  failures=$(echo "${failuretests}" | wc -l)
  total=$(/bin/find tests/ -name "*.output" | wc -l)

  # Echo the following information to gauge build health
  echo "${failuretests}" >"$1/$2_check_failures.log"
  echo "actualFailures:$failures"
  echo "totalTests:$total"
  echo "expectedFailures:15"
}

zopen_get_version() {
  ./bash --version | head -1 | awk -F" " '{print $4}' | awk -F"(" '{print $1}'
}
